{"version":3,"file":"js-data-ignite.js","sources":["../src/index.js"],"sourcesContent":["import knex from 'knex'\nimport { utils } from 'js-data'\nimport {\n  Adapter,\n  reserved\n} from 'js-data-adapter'\nimport toString from 'lodash.tostring'\nimport snakeCase from 'lodash.snakecase'\n\nconst IgniteClient = require('nodejs-thin-client')\nconst SqlFieldsQuery = IgniteClient.SqlFieldsQuery\n\nconst DEFAULTS = {}\n\nconst equal = function (query, field, value, isOr) {\n  if (value === null) {\n    return query[isOr ? 'orWhereNull' : 'whereNull'](field)\n  }\n  return query[getWhereType(isOr)](field, value)\n}\n\nconst notEqual = function (query, field, value, isOr) {\n  if (value === null) {\n    return query[isOr ? 'orWhereNotNull' : 'whereNotNull'](field)\n  }\n  return query[getWhereType(isOr)](field, '!=', value)\n}\n\nconst getWhereType = function (isOr) {\n  return isOr ? 'orWhere' : 'where'\n}\n\nconst MILES_REGEXP = /(\\d+(\\.\\d+)?)\\s*(m|M)iles$/\nconst KILOMETERS_REGEXP = /(\\d+(\\.\\d+)?)\\s*(k|K)$/\n\n/**\n * Default predicate functions for the filtering operators.\n *\n * @name module:js-data-sql.OPERATORS\n * @property {Function} == Equality operator.\n * @property {Function} != Inequality operator.\n * @property {Function} > \"Greater than\" operator.\n * @property {Function} >= \"Greater than or equal to\" operator.\n * @property {Function} < \"Less than\" operator.\n * @property {Function} <= \"Less than or equal to\" operator.\n * @property {Function} isectEmpty Operator to test that the intersection\n * between two arrays is empty. Not supported.\n * @property {Function} isectNotEmpty Operator to test that the intersection\n * between two arrays is NOT empty. Not supported.\n * @property {Function} in Operator to test whether a value is found in the\n * provided array.\n * @property {Function} notIn Operator to test whether a value is NOT found in\n * the provided array.\n * @property {Function} contains Operator to test whether an array contains the\n * provided value. Not supported.\n * @property {Function} notContains Operator to test whether an array does NOT\n * contain the provided value. Not supported.\n */\nexport const OPERATORS = {\n  '=': equal,\n  '==': equal,\n  '===': equal,\n  '!=': notEqual,\n  '!==': notEqual,\n  '>': function (query, field, value, isOr) {\n    return query[getWhereType(isOr)](field, '>', value)\n  },\n  '>=': function (query, field, value, isOr) {\n    return query[getWhereType(isOr)](field, '>=', value)\n  },\n  '<': function (query, field, value, isOr) {\n    return query[getWhereType(isOr)](field, '<', value)\n  },\n  '<=': function (query, field, value, isOr) {\n    return query[getWhereType(isOr)](field, '<=', value)\n  },\n  'isectEmpty': function (query, field, value, isOr) {\n    throw new Error('isectEmpty not supported!')\n  },\n  'isectNotEmpty': function (query, field, value, isOr) {\n    throw new Error('isectNotEmpty not supported!')\n  },\n  'in': function (query, field, value, isOr) {\n    return query[getWhereType(isOr)](field, 'in', value)\n  },\n  'notIn': function (query, field, value, isOr) {\n    return query[isOr ? 'orNotIn' : 'notIn'](field, 'not in', value)\n  },\n  'contains': function (query, field, value, isOr) {\n    throw new Error('contains not supported!')\n  },\n  'notContains': function (query, field, value, isOr) {\n    throw new Error('notContains not supported!')\n  },\n  'like': function (query, field, value, isOr) {\n    return query[getWhereType(isOr)](field, 'like', value)\n  },\n  'notLike': function (query, field, value, isOr) {\n    return query[getWhereType(isOr)](field, 'not like', value)\n  },\n  'likei': function (query, field, value, isOr, knexInstance) {\n    return query[getWhereType(isOr)](knexInstance.raw(`LOWER(${field})`), 'like', knexInstance.raw(`LOWER('${value}')`))\n  },\n  'subquery': function (query, field, value, isOr, knexInstance) {\n    if (!value.field || !value.table || !value.filterField || !value.filterValue) {\n      throw new Error('Missing subquery fields')\n    }\n\n    return query[getWhereType(isOr)](field, 'in', knexInstance(value.table).where(value.filterField, value.filterValue).select(value.field))\n  },\n  'near': function (query, field, value, isOr) {\n    let radius\n    let unitsPerDegree\n    if (typeof value.radius === 'number' || MILES_REGEXP.test(value.radius)) {\n      radius = typeof value.radius === 'number' ? value.radius : value.radius.match(MILES_REGEXP)[1]\n      unitsPerDegree = 69.0 // miles per degree\n    } else if (KILOMETERS_REGEXP.test(value.radius)) {\n      radius = value.radius.match(KILOMETERS_REGEXP)[1]\n      unitsPerDegree = 111.045 // kilometers per degree;\n    } else {\n      throw new Error('Unknown radius distance units')\n    }\n\n    let [latitudeColumn, longitudeColumn] = field.split(',').map((c) => c.trim())\n    let [latitude, longitude] = value.center\n\n    // Uses indexes on `latitudeColumn` / `longitudeColumn` if available\n    query = query\n      .whereBetween(latitudeColumn, [\n        latitude - (radius / unitsPerDegree),\n        latitude + (radius / unitsPerDegree)\n      ])\n      .whereBetween(longitudeColumn, [\n        longitude - (radius / (unitsPerDegree * Math.cos(latitude * (Math.PI / 180)))),\n        longitude + (radius / (unitsPerDegree * Math.cos(latitude * (Math.PI / 180))))\n      ])\n\n    if (value.calculateDistance) {\n      let distanceColumn = (typeof value.calculateDistance === 'string') ? value.calculateDistance : 'distance'\n      query = query.select(knex.raw(`\n        ${unitsPerDegree} * DEGREES(ACOS(\n          COS(RADIANS(?)) * COS(RADIANS(${latitudeColumn})) *\n          COS(RADIANS(${longitudeColumn}) - RADIANS(?)) +\n          SIN(RADIANS(?)) * SIN(RADIANS(${latitudeColumn}))\n        )) AS ${distanceColumn}`, [latitude, longitude, latitude]))\n    }\n    return query\n  }\n}\n\nObject.freeze(OPERATORS)\n\n/**\n * IgniteAdapter class.\n *\n * @example\n * // Use Container instead of DataStore on the server\n * import { Container } from 'js-data';\n * import IgniteAdapter from 'js-data-sql';\n *\n * // Create a store to hold your Mappers\n * const store = new Container();\n *\n * // Create an instance of IgniteAdapter with default settings\n * const adapter = new IgniteAdapter();\n *\n * // Mappers in \"store\" will use the Sql adapter by default\n * store.registerAdapter('sql', adapter, { default: true });\n *\n * // Create a Mapper that maps to a \"user\" table\n * store.defineMapper('user');\n *\n * @class IgniteAdapter\n * @extends Adapter\n * @param {Object} [opts] Configuration options.\n * @param {boolean} [opts.debug=false] See {@link Adapter#debug}.\n * @param {Object} [opts.knexOpts] See {@link IgniteAdapter#knexOpts}.\n * @param {Object} [opts.operators] See {@link IgniteAdapter#operators}.\n * @param {boolean} [opts.raw=false] See {@link Adapter#raw}.\n */\nexport function IgniteAdapter (opts) {\n  utils.classCallCheck(this, IgniteAdapter)\n  opts || (opts = {})\n  opts.knexOpts || (opts.knexOpts = {})\n  opts.igniteClient || (opts.igniteClient = {})\n  utils.fillIn(opts, DEFAULTS)\n\n  Object.defineProperties(this, {\n    knex: {\n      writable: true,\n      value: undefined\n    },\n\n    igniteClient: {\n      writable: true,\n      value: undefined\n    }\n  })\n\n  Adapter.call(this, opts)\n\n  /**\n   * Override the default predicate functions for specified operators.\n   *\n   * @name IgniteAdapter#operators\n   * @type {Object}\n   * @default {}\n   */\n  this.knex || (this.knex = knex(this.knexOpts))\n\n  /**\n   * Override the default predicate functions for specified operators.\n   *\n   * @name IgniteAdapter#operators\n   * @type {Object}\n   * @default {}\n   */\n  this.operators || (this.operators = {})\n  utils.fillIn(this.operators, OPERATORS)\n\n  this.igniteClient || (this.igniteClient = opts.igniteClient)\n}\n\nfunction getTable (mapper) {\n  return mapper.table || snakeCase(mapper.name)\n}\n\nfunction getCacheName (mapper) {\n  return 'SQL_PUBLIC_' + getTable(mapper).toUpperCase()\n}\n\nfunction getFields (mapper, sqlBuilder) {\n  const fields = mapper.schema.properties\n  const table = getTable(mapper)\n\n  for (const field in fields) {\n    if (fields.hasOwnProperty(field)) {\n      sqlBuilder = sqlBuilder.select(`${table}.${field}`)\n    }\n  }\n\n  return sqlBuilder\n}\n\nfunction escapeData (mapper, props, knexInstance) {\n  for (const field in props) {\n    if (props.hasOwnProperty(field)) {\n      const types = Array.isArray(mapper.schema.properties[field].type) ? mapper.schema.properties[field].type.join('|') : mapper.schema.properties[field].type\n      switch (types) {\n        case 'array':\n        case 'array|null':\n          props[field] = props[field] ? knexInstance.raw(`'${JSON.stringify(props[field])}'`) : null\n          break\n        case 'date':\n        case 'date|null':\n          props[field] = props[field] ? knexInstance.raw(`TIMESTAMP '${props[field].toISOString()}'`) : null\n          break\n        case 'string':\n        case 'string|null':\n          props[field] = props[field] ? knexInstance.raw(`'${props[field].replace(/'/g, \"''\").replace(/\\?/g, '\\\\?')}'`) : null\n          break\n        case 'boolean':\n          props[field] = props[field] === false ? knexInstance.raw('FALSE') : props[field] === true ? knexInstance.raw('TRUE') : null\n      }\n    }\n  }\n\n  return props\n}\n\nfunction translateToKnex (mapper, values) {\n  if (!values || !values.length) {\n    return null\n  }\n\n  const fields = mapper.schema.properties\n\n  const result = {}\n  let i = 0\n\n  for (const field in fields) {\n    if (fields.hasOwnProperty(field)) {\n      const types = Array.isArray(fields[field].type) ? fields[field].type.join('|') : fields[field].type\n      switch (types) {\n        case 'array':\n        case 'array|null':\n          result[field] = values[i] ? JSON.parse(values[i++].replace(/\\\\/g, '')) : values[i++]\n          break\n        default:\n          result[field] = values[i++]\n          break\n      }\n    }\n  }\n\n  return result\n}\n\n/**\n * Alternative to ES2015 class syntax for extending `IgniteAdapter`.\n *\n * @example <caption>Using the ES2015 class syntax.</caption>\n * class MyIgniteAdapter extends IgniteAdapter {...};\n * const adapter = new MyIgniteAdapter();\n *\n * @example <caption>Using {@link IgniteAdapter.extend}.</caption>\n * const instanceProps = {...};\n * const classProps = {...};\n *\n * const MyIgniteAdapter = IgniteAdapter.extend(instanceProps, classProps);\n * const adapter = new MyIgniteAdapter();\n *\n * @method IgniteAdapter.extend\n * @static\n * @param {Object} [instanceProps] Properties that will be added to the\n * prototype of the subclass.\n * @param {Object} [classProps] Properties that will be added as static\n * properties to the subclass itself.\n * @return {Constructor} Subclass of `IgniteAdapter`.\n */\nIgniteAdapter.extend = utils.extend\n\nAdapter.extend({\n  constructor: IgniteAdapter,\n\n  async _count (mapper, query, opts) {\n    opts || (opts = {})\n    query || (query = {})\n\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    const sqlText = this.filterQuery(sqlBuilder(getTable(mapper)), query, opts)\n      .count('* as count')\n      .toString()\n\n    const countQuery = new SqlFieldsQuery(sqlText)\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    const result = await (await cache.query(countQuery)).getAll()\n\n    return [result[0][0], {}]\n  },\n\n  async _create (mapper, props, opts) {\n    const idAttribute = mapper.idAttribute\n    props || (props = {})\n    opts || (opts = {})\n\n    props = escapeData(mapper, props, this.knex)\n\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    const sqlText = sqlBuilder(getTable(mapper))\n      .insert(props)\n      .toString()\n\n    const createQuery = new SqlFieldsQuery(sqlText)\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    await cache.query(createQuery)\n\n    return this._find(mapper, props[idAttribute], opts)\n  },\n\n  async _createMany (mapper, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    props = props.map((singleProps) => {\n      singleProps = escapeData(mapper, singleProps, this.knex)\n      return singleProps\n    })\n\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    const sqlText = sqlBuilder(getTable(mapper))\n      .insert(props)\n      .toString()\n\n    const createQuery = new SqlFieldsQuery(sqlText)\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    await cache.query(createQuery)\n\n    const query = {\n      where: {\n        [mapper.idAttribute]: {\n          'in': props.map((singleProps) => singleProps[mapper.idAttribute])\n        }\n      }\n    }\n\n    return this._findAll(mapper, query, opts)\n  },\n\n  async _destroy (mapper, id, opts) {\n    opts || (opts = {})\n\n    const record = await this._find(mapper, id, opts)\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    const sqlText = sqlBuilder(getTable(mapper))\n      .where(mapper.idAttribute, toString(id))\n      .del()\n      .toString()\n\n    const destroyQuery = new SqlFieldsQuery(sqlText)\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    await cache.query(destroyQuery)\n\n    return record\n  },\n\n  async _destroyAll (mapper, query, opts) {\n    query || (query = {})\n    opts || (opts = {})\n\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    const sqlText = this.filterQuery(sqlBuilder(getTable(mapper)), query, opts)\n      .del()\n      .toString()\n\n    const destroyAllQuery = new SqlFieldsQuery(sqlText)\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    await cache.query(destroyAllQuery)\n\n    return [[], {}]\n  },\n\n  async _find (mapper, id, opts) {\n    opts || (opts = {})\n\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    const table = getTable(mapper)\n\n    let sqlText\n    if (Array.isArray(id)) {\n      if (!mapper.compositePk) {\n        throw new Error('Model does not have composite PK')\n      }\n\n      sqlText = this.compositePk(mapper, getFields(mapper, sqlBuilder).from(table), id, this.knex)\n    } else {\n      sqlText = getFields(mapper, sqlBuilder)\n        .from(table)\n        .where(`${table}.${mapper.idAttribute}`, id)\n    }\n\n    sqlText = sqlText.toString()\n\n    const findQuery = new SqlFieldsQuery(sqlText)\n\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    const result = await (await cache.query(findQuery)).getAll()\n\n    return [translateToKnex(mapper, result[0]), {}]\n  },\n\n  async _findAll (mapper, query, opts) {\n    query || (query = {})\n    opts || (opts = {})\n\n    const sqlText = this.filterQuery(this.selectTable(mapper, opts), query, opts).toString()\n\n    const findAllQuery = new SqlFieldsQuery(sqlText)\n\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    const records = await (await cache.query(findAllQuery)).getAll()\n    const result = records.map((record) => {\n      return translateToKnex(mapper, record)\n    })\n\n    return [result, {}]\n  },\n\n  async _sum (mapper, field, query, opts) {\n    if (!utils.isString(field)) {\n      throw new Error('field must be a string!')\n    }\n    opts || (opts = {})\n    query || (query = {})\n\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    const sqlText = this.filterQuery(sqlBuilder(getTable(mapper)), query, opts)\n      .sum(`${field} as sum`)\n      .toString()\n\n    const sumQuery = new SqlFieldsQuery(sqlText)\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    const result = await (await cache.query(sumQuery)).getAll()\n\n    return [result[0][0], {}]\n  },\n\n  async _update (mapper, id, props, opts) {\n    props || (props = {})\n    opts || (opts = {})\n\n    props = escapeData(mapper, props, this.knex)\n\n    const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n    let sqlText\n\n    const ids = []\n    if (mapper.compositePk) {\n      for (const field of mapper.compositePk) {\n        ids.push(props[field])\n        delete props[field]\n      }\n\n      sqlText = this.compositePk(mapper, sqlBuilder(getTable(mapper)), ids, this.knex)\n    } else {\n      for (const field in props) {\n        if (props.hasOwnProperty(field) && field === mapper.idAttribute) {\n          delete props[field]\n        }\n      }\n\n      sqlText = sqlBuilder(getTable(mapper))\n        .where(mapper.idAttribute, toString(id))\n    }\n\n    sqlText = sqlText.update(props).toString()\n\n    const updateQuery = new SqlFieldsQuery(sqlText)\n    const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    await cache.query(updateQuery)\n\n    return mapper.compositePk ? this._find(mapper, ids, opts) : this._find(mapper, id, opts)\n  },\n\n  async _updateAll (mapper, props, query, opts) {\n    props || (props = {})\n    query || (query = {})\n    opts || (opts = {})\n\n    console.log(props)\n\n    if (mapper.compositePk) {\n      for (const field of mapper.compositePk) {\n        delete props[field]\n      }\n    } else {\n      for (const field in props) {\n        if (props.hasOwnProperty(field) && field === mapper.idAttribute) {\n          delete props[field]\n        }\n      }\n    }\n\n    console.log(props)\n\n    const escapedProps = escapeData(mapper, props, this.knex)\n    console.log(escapedProps)\n\n    return [[], {}]\n\n    // const sqlBuilder = utils.isUndefined(opts.transaction) ? this.knex : opts.transaction\n\n    // const sqlText = this.filterQuery(sqlBuilder(getTable(mapper)), query, opts).update(escapedProps).toString()\n\n    // console.log(sqlText)\n\n    // const updateAllQuery = new SqlFieldsQuery(sqlText)\n    // const cache = await this.igniteClient.getCache(getCacheName(mapper))\n    // await cache.query(updateAllQuery)\n\n    // return [[], {}]\n  },\n\n  async _updateMany (mapper, records, opts) {\n    const idAttribute = mapper.idAttribute\n    records || (records = [])\n    opts || (opts = {})\n\n    const tasks = records.map((record) => this._update(mapper, record[idAttribute], record, opts))\n\n    return Promise.all(tasks).then((results) => [results.map((result) => result[0]), {}])\n  },\n\n  compositePk (mapper, sqlBuilder, pkValues, knexInstance) {\n    const query = {}\n\n    for (const [index, field] of mapper.compositePk.entries()) {\n      query[field] = pkValues[index]\n      // switch (mapper.schema.properties[field].type) {\n      //   case 'date':\n      //     query[field] = knexInstance.raw(`TIMESTAMP '${pkValues[index].toISOString()}'`)\n      //     break\n      //   default:\n      //     query[field] = pkValues[index]\n      //     break\n      // }\n    }\n\n    return sqlBuilder.where(query)\n  },\n\n  applyWhereFromObject (sqlBuilder, where, opts) {\n    utils.forOwn(where, (criteria, field) => {\n      if (!utils.isObject(criteria)) {\n        criteria = { '==': criteria }\n      }\n      // Apply filter for each operator\n      utils.forOwn(criteria, (value, operator) => {\n        let isOr = false\n        if (operator && operator[0] === '|') {\n          operator = operator.substr(1)\n          isOr = true\n        }\n        let predicateFn = this.getOperator(operator, opts)\n        if (predicateFn) {\n          sqlBuilder = predicateFn(sqlBuilder, field, value, isOr, this.knex)\n        } else {\n          throw new Error(`Operator ${operator} not supported!`)\n        }\n      })\n    })\n    return sqlBuilder\n  },\n\n  applyWhereFromArray (sqlBuilder, where, opts) {\n    where.forEach((_where, i) => {\n      if (_where === 'and' || _where === 'or') {\n        return\n      }\n      const self = this\n      const prev = where[i - 1]\n      const parser = utils.isArray(_where) ? this.applyWhereFromArray : this.applyWhereFromObject\n      if (prev) {\n        if (prev === 'or') {\n          sqlBuilder = sqlBuilder.orWhere(function () {\n            parser.call(self, this, _where, opts)\n          })\n        } else {\n          sqlBuilder = sqlBuilder.andWhere(function () {\n            parser.call(self, this, _where, opts)\n          })\n        }\n      } else {\n        sqlBuilder = sqlBuilder.where(function () {\n          parser.call(self, this, _where, opts)\n        })\n      }\n    })\n    return sqlBuilder\n  },\n\n  filterQuery (sqlBuilder, query, opts) {\n    query = utils.plainCopy(query || {})\n    opts || (opts = {})\n    opts.operators || (opts.operators = {})\n    query.where || (query.where = {})\n    query.orderBy || (query.orderBy = query.sort)\n    query.orderBy || (query.orderBy = [])\n    query.skip || (query.skip = query.offset)\n\n    // Transform non-keyword properties to \"where\" clause configuration\n    utils.forOwn(query, (config, keyword) => {\n      if (reserved.indexOf(keyword) === -1) {\n        if (utils.isObject(config)) {\n          query.where[keyword] = config\n        } else {\n          query.where[keyword] = {\n            '==': config\n          }\n        }\n        delete query[keyword]\n      }\n    })\n\n    // Filter\n    if (utils.isObject(query.where) && Object.keys(query.where).length !== 0) {\n      // Apply filter for each field\n      sqlBuilder = this.applyWhereFromObject(sqlBuilder, query.where, opts)\n    } else if (utils.isArray(query.where)) {\n      sqlBuilder = this.applyWhereFromArray(sqlBuilder, query.where, opts)\n    }\n\n    // Sort\n    if (query.orderBy) {\n      if (utils.isString(query.orderBy)) {\n        query.orderBy = [\n          [query.orderBy, 'asc']\n        ]\n      }\n      for (var i = 0; i < query.orderBy.length; i++) {\n        if (utils.isString(query.orderBy[i])) {\n          query.orderBy[i] = [query.orderBy[i], 'asc']\n        }\n        sqlBuilder = sqlBuilder.orderBy(query.orderBy[i][0], (query.orderBy[i][1] || '').toUpperCase() === 'DESC' ? 'desc' : 'asc')\n      }\n    }\n\n    // Offset\n    if (query.skip) {\n      sqlBuilder = sqlBuilder.offset(+query.skip)\n    }\n\n    // Limit\n    if (query.limit) {\n      sqlBuilder = sqlBuilder.limit(+query.limit)\n    }\n\n    return sqlBuilder\n  },\n\n  /**\n   * Resolve the predicate function for the specified operator based on the\n   * given options and this adapter's settings.\n   *\n   * @name IgniteAdapter#getOperator\n   * @method\n   * @param {string} operator The name of the operator.\n   * @param {Object} [opts] Configuration options.\n   * @param {Object} [opts.operators] Override the default predicate functions\n   * for specified operators.\n   * @return {*} The predicate function for the specified operator.\n   */\n  getOperator (operator, opts) {\n    opts || (opts = {})\n    opts.operators || (opts.operators = {})\n    let ownOps = this.operators || {}\n    return utils.isUndefined(opts.operators[operator]) ? ownOps[operator] : opts.operators[operator]\n  },\n\n  getTable (mapper) {\n    return mapper.table || snakeCase(mapper.name)\n  },\n\n  selectTable (mapper, opts) {\n    opts || (opts = {})\n    const query = utils.isUndefined(opts.query) ? this.knex : opts.query\n    const table = this.getTable(mapper)\n    return getFields(mapper, query).from(table)\n  }\n})\n\n/**\n * Details of the current version of the `js-data-ignite` module.\n *\n * @example\n * import { version } from 'js-data-ignite';\n * console.log(version.full);\n *\n * @name module:js-data-ignite.version\n * @type {object}\n * @property {string} version.full The full semver value.\n * @property {number} version.major The major version number.\n * @property {number} version.minor The minor version number.\n * @property {number} version.patch The patch version number.\n * @property {(string|boolean)} version.alpha The alpha version value,\n * otherwise `false` if the current version is not alpha.\n * @property {(string|boolean)} version.beta The beta version value,\n * otherwise `false` if the current version is not beta.\n */\nexport const version = '<%= version %>'\n"],"names":["IgniteClient","require","SqlFieldsQuery","DEFAULTS","equal","query","field","value","isOr","getWhereType","notEqual","MILES_REGEXP","KILOMETERS_REGEXP","OPERATORS","Error","knexInstance","raw","table","filterField","filterValue","where","select","radius","unitsPerDegree","test","match","split","map","c","trim","latitudeColumn","longitudeColumn","center","latitude","longitude","whereBetween","Math","cos","PI","calculateDistance","distanceColumn","knex","Object","freeze","IgniteAdapter","opts","classCallCheck","knexOpts","igniteClient","fillIn","defineProperties","undefined","call","operators","getTable","mapper","snakeCase","name","getCacheName","toUpperCase","getFields","sqlBuilder","fields","schema","properties","hasOwnProperty","escapeData","props","types","Array","isArray","type","join","JSON","stringify","toISOString","replace","translateToKnex","values","length","result","i","parse","extend","utils","Adapter","isUndefined","transaction","sqlText","filterQuery","count","toString","countQuery","cache","getCache","getAll","idAttribute","insert","createQuery","_find","singleProps","_findAll","id","record","del","destroyQuery","destroyAllQuery","compositePk","from","findQuery","selectTable","findAllQuery","records","isString","sum","sumQuery","ids","push","update","updateQuery","log","escapedProps","tasks","_update","Promise","all","then","results","pkValues","entries","index","forOwn","criteria","isObject","operator","substr","predicateFn","getOperator","forEach","_where","self","prev","parser","applyWhereFromArray","applyWhereFromObject","orWhere","andWhere","plainCopy","orderBy","sort","skip","offset","config","keyword","reserved","indexOf","keys","limit","ownOps","version"],"mappings":"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"}